<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Linear Regression with Sliders</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    /* Make the plot fill the entire width */
    #plot {
      width: 100%;
      height: 80vh;
      margin: 0 auto;
    }

    /* Center the sliders and set width to 60% */
    .slider-container {
      width: 60%;
      margin: 20px auto;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="plot" style="width: 100%; height: 80vh;"></div>
  <div class="slider-container">
    <label for="slope-slider">Steigung: <span id="slope-value">600</span></label>
    <input type="range" id="slope-slider" min="500" max="800" step="1" value="600" style="width: 100%;">
    <label for="intercept-slider">y-Achsenabschnitt: <span id="intercept-value">-150</span></label>
    <input type="range" id="intercept-slider" min="-150" max="-100" step="1" value="-150" style="width: 100%;">
  </div>

  <script>
    // Use provided data
    const xData = [
      0.22923146289747925, 0.278967733861732, 0.2828642741736615, 0.259886136538919, 
      0.2919357144166995, 0.3202025428407269, 0.3943092950605265, 0.3087288906415919, 
      0.3128775195361382, 0.29627770421169164, 0.2040614392350479, 0.29867430622753915, 
      0.30301151049705133, 0.4231621056242643, 0.29038195176094383, 0.3150773671166806, 
      0.2982644115147378, 0.24156609811902338, 0.35714114072575104, 0.3375966516343387, 
      0.33955159735215235, 0.25453062726026304, 0.37013971554680497, 0.22990744686038594, 
      0.3293428546900135, 0.4095227812904989, 0.25047318374346556, 0.2716851135198614, 
      0.304982568254382, 0.27482621729419004, 0.22246682844669335, 0.30342814874030133, 
      0.24688481431369474, 0.32367962153175905, 0.2540287882883098, 0.377496720250877, 
      0.26083733538318815, 0.28389692418971624, 0.34067586086848345, 0.23845678417830224, 
      0.31137299673020646, 0.36535713771412137, 0.2196258382719386, 0.3092316929266152, 
      0.3129941397124212, 0.3390911435888655, 0.2381524644560959, 0.23397716934578616, 
      0.3260970782808449, 0.3148492336616593, 0.31252464251729384, 0.31732241047484877, 
      0.26599876392107547, 0.31161268485805016, 0.31465362366493405, 0.2642824290986816, 
      0.3932887255572378, 0.32369164604558937, 0.24043482513986755, 0.3328276804316915, 
      0.25126591648863394, 0.3393542301871226, 0.3579297789503702, 0.25896588408241444, 
      0.3481688064622161, 0.3206390463468249, 0.3411030079997245, 0.39483964913269737, 
      0.28773059419985647, 0.26231319178212553, 0.25552427851872384, 0.2592094857517281, 
      0.29614491452929476, 0.31705759874083217, 0.31383453996650096, 0.3413591624518012, 
      0.30065009459389536, 0.37267670385786583, 0.2867671583381022, 0.43600845832948093, 
      0.3312833673882503, 0.25714212217918586, 0.24645537509694437, 0.3241236207621593, 
      0.28882686073370745, 0.3357000247046046, 0.32366188122867723, 0.29635855436715636, 
      0.25766031409657975, 0.22425763876570676, 0.27767425239664895, 0.34281993971617364, 
      0.3107046872065102, 0.2377130610644006, 0.3086590462925591, 0.3192658689864418, 
      0.25580712818994333, 0.3076862552972764, 0.3029104359223, 0.24285148510846882
    ];
    const yData = [
      13.579004999999995, 30.992710000000024, 30.30935000000003, 22.10348324999999, 
      40.66428499999997, 44.93902499999997, 125.5529306428571, 39.93772500000001, 
      43.987844999999965, 39.49202500000003, 9.009723000000001, 42.65335499999996, 
      42.067874999999965, 151.5797646428573, 41.39463499999998, 45.08422499999997, 
      42.41728499999997, 20.750142249999982, 91.96598999999983, 80.17268999999986, 
      73.88834999999986, 20.872002249999976, 112.82289999999983, 13.910144999999995, 
      73.46924999999985, 142.38654564285721, 21.403182249999986, 31.047420000000024, 
      42.65335499999996, 31.442370000000025, 11.694749999999997, 39.55241500000004, 
      20.750142249999982, 45.08776499999999, 19.67632224999998, 124.29902464285703, 
      24.78779125, 32.195350000000026, 82.24595999999987, 17.373774999999988, 
      41.648955000000015, 112.75595999999983, 11.429429999999995, 42.82174499999994, 
      43.819034999999964, 76.32713999999986, 16.96046499999999, 12.765314999999996, 
      71.59649999999986, 43.819034999999964, 43.40236499999996, 45.08422499999997, 
      30.086531250000018, 41.648955000000015, 41.648955000000015, 23.409141249999998, 
      122.4465146428571, 45.25657499999997, 20.750142249999982, 71.63663999999986, 
      20.774772249999977, 75.07577999999985, 91.96598999999983, 25.10255125, 
      82.7692199999998, 43.59470500000001, 77.34770999999984, 123.48760564285705, 
      37.34115999999999, 24.95849125, 24.302751249999996, 22.10348324999999, 
      42.335804999999965, 43.30049500000002, 43.819034999999964, 76.43543999999984, 
      42.335804999999965, 104.04954999999984, 37.609089999999995, 151.5797646428573, 
      72.35744999999986, 24.302751249999996, 18.45394424999998, 45.25657499999997, 
      38.33736999999999, 76.32713999999986, 43.06673500000001, 42.067874999999965, 
      24.473451249999997, 11.221499999999994, 30.992710000000024, 76.43543999999984, 
      43.987844999999965, 17.373774999999988, 42.82174499999994, 44.91541499999998, 
      24.302751249999996, 42.23626499999996, 42.335804999999965, 20.750142249999982
    ];

function calculateR2(xData, yData, slope, intercept) {
  let ssTot = 0;
  let ssRes = 0;
  const meanY = yData.reduce((a, b) => a + b, 0) / yData.length;

  for (let i = 0; i < xData.length; i++) {
    const predictedY = slope * xData[i] + intercept;
    ssTot += Math.pow(yData[i] - meanY, 2);
    ssRes += Math.pow(yData[i] - predictedY, 2);
  }

  return 1 - (ssRes / ssTot);
}


    // Initial slope and intercept
    let slope = 600;
    let intercept = -150;

    // Function to update the plot
    function drawPlot() {
      // Calculate y values for the line based on the current slope and intercept
      const xLine = [0, 0.45];
      const yLine = xLine.map(x => slope * x + intercept);

      const data = [
        {
          x: xData,
          y: yData,
          mode: 'markers',
          type: 'scatter',
          name: 'Daten',
          marker: { color: 'blue' }
        },
        {
          x: xLine,
          y: yLine,
          mode: 'lines',
          type: 'scatter',
          name: 'Regression',
          line: { color: 'red' }
        }
      ];

        // Calculate R² score
      const r2Score = calculateR2(xData, yData, slope, intercept);

      const layout = {
        title: `Lineare Regression (R² = ${r2Score.toFixed(4)})`,
        xaxis: { title: 'Füllgrad', range: [0, 0.45]},
        yaxis: { title: 'Prognose', range: [-150, 170]},
      };

      Plotly.newPlot('plot', data, layout);
    }

    // Initial draw
    drawPlot();

    // Event listeners for the sliders
    document.getElementById('slope-slider').addEventListener('input', function(event) {
      slope = parseFloat(event.target.value);
      document.getElementById('slope-value').innerText = slope.toFixed(1);
      drawPlot();
    });

    document.getElementById('intercept-slider').addEventListener('input', function(event) {
      intercept = parseFloat(event.target.value);
      document.getElementById('intercept-value').innerText = intercept.toFixed(1);
      drawPlot();
    });
  </script>
</body>
</html>
